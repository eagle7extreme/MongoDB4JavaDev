<html><head><title>Untitled document</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_dgiphh7kofmx-4.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-4 0}ol.lst-kix_dgiphh7kofmx-8{list-style-type:none}ol.lst-kix_dgiphh7kofmx-7{list-style-type:none}.lst-kix_dgiphh7kofmx-1>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-1,lower-latin) ". "}.lst-kix_dgiphh7kofmx-7>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-7,lower-latin) ". "}.lst-kix_dgiphh7kofmx-8>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-8,lower-roman) ". "}.lst-kix_dgiphh7kofmx-1>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-1}.lst-kix_dgiphh7kofmx-0>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-0,decimal) ". "}.lst-kix_dgiphh7kofmx-5>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-5}ol.lst-kix_dgiphh7kofmx-3.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-3 0}.lst-kix_dgiphh7kofmx-2>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-2,lower-roman) ". "}.lst-kix_dgiphh7kofmx-7>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-7}.lst-kix_dgiphh7kofmx-3>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-3}.lst-kix_dgiphh7kofmx-4>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-4,lower-latin) ". "}.lst-kix_dgiphh7kofmx-0>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-0}.lst-kix_dgiphh7kofmx-3>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-3,decimal) ". "}.lst-kix_dgiphh7kofmx-6>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-6,decimal) ". "}.lst-kix_dgiphh7kofmx-8>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-8}ol.lst-kix_dgiphh7kofmx-5.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-5 0}ol.lst-kix_dgiphh7kofmx-7.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-7 0}ol.lst-kix_dgiphh7kofmx-2.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-2 0}.lst-kix_dgiphh7kofmx-6>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-6}ol.lst-kix_dgiphh7kofmx-0.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-0 0}.lst-kix_dgiphh7kofmx-4>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-4}ol.lst-kix_dgiphh7kofmx-6.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-6 0}.lst-kix_dgiphh7kofmx-5>li:before{content:"" counter(lst-ctn-kix_dgiphh7kofmx-5,lower-roman) ". "}ol.lst-kix_dgiphh7kofmx-1.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-1 0}ol.lst-kix_dgiphh7kofmx-3{list-style-type:none}ol.lst-kix_dgiphh7kofmx-4{list-style-type:none}ol.lst-kix_dgiphh7kofmx-8.start{counter-reset:lst-ctn-kix_dgiphh7kofmx-8 0}ol.lst-kix_dgiphh7kofmx-5{list-style-type:none}ol.lst-kix_dgiphh7kofmx-6{list-style-type:none}.lst-kix_dgiphh7kofmx-2>li{counter-increment:lst-ctn-kix_dgiphh7kofmx-2}ol.lst-kix_dgiphh7kofmx-0{list-style-type:none}ol.lst-kix_dgiphh7kofmx-1{list-style-type:none}ol.lst-kix_dgiphh7kofmx-2{list-style-type:none}ol{margin:0;padding:0}.c4{line-height:1.375;height:11pt;direction:ltr;padding-bottom:8pt}.c2{color:#615f5e;font-size:12pt;background-color:#ffffff}.c3{color:#3c3c3c;font-size:12pt;background-color:#ffffff}.c5{line-height:1.375;direction:ltr;padding-bottom:8pt}.c8{color:#6ba539;font-size:15pt;background-color:#ffffff}.c1{line-height:1.5;direction:ltr;padding-bottom:17pt}.c11{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c0{color:#615f5e;background-color:#f8f8f8;font-family:"Verdana"}.c12{line-height:1.375;direction:ltr}.c10{height:11pt;direction:ltr}.c6{line-height:1.4;direction:ltr}.c7{padding-top:15pt}.c13{padding-bottom:11pt}.c9{font-weight:bold}.title{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt}.subtitle{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt}h2{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h3{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h4{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt}h5{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}h6{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}</style></head><body class="c11"><h2 class="c6 c13"><a name="h.hhs3q13ykwxm"></a><span class="c8">Final: Final.2</span></h2><p class="c1"><span class="c2">Let&#39;s do that again with a slightly different crash/recover scenario for each process. With all three members (mongod&#39;s) up and running, once again:</span></p><p class="c6"><span class="c0">$ mongo --shell --port 27003 a.js<br>&gt; // be sure 27003 is the primary. <br>&gt; // use rs.stepDown() elsewhere if it isn&#39;t.<br>&gt; testRollback()<br></span></p><p class="c1"><span class="c2">Now this time, shut down the </span><span class="c0">mongod</span><span class="c2">&nbsp;on port 27003 (in addition to the other two members being shut down by </span><span class="c0">testRollback()</span><span class="c2">&nbsp;already) before doing anything else:</span></p><p class="c6"><span class="c0">$ ps -A | grep mongod<br>$ # should see the 27003 one running (only)<br>$ killall mongod<br>$ # wait a little for the shutdown perhaps...then:<br>$ ps -A | grep mongod<br>$ # should get that none are present&hellip;<br></span></p><p class="c1"><span class="c2">Now restart just the 27001 and 27002 members. Wait for them to get healthy -- check this with</span><span class="c0">rs.status()</span><span class="c2">&nbsp;in the shell. Then query</span></p><p class="c6"><span class="c0">&gt; db.foo.find()<br></span></p><p class="c12"><span class="c2">Then add another document:</span></p><p class="c6"><span class="c0">&gt; db.foo.insert({_id:&quot;last&quot;})<br>&gt; db.getLastErrorObj(2)<br></span></p><p class="c1"><span class="c2">After this (be sure the above worked first), restart the third set member (</span><span class="c0">mongod</span><span class="c2">&nbsp;on port 27003). Wait for it to come online and enter a health state (secondary or primary).</span></p><p class="c1 c7"><span class="c2">Run (on any member -- try multiple if you like) :</span></p><p class="c6"><span class="c0">&gt; db.foo.find()<br></span></p><p class="c1"><span class="c2">You should see a difference from problem 1 in the result above.</span></p><p class="c1 c7"><span class="c2">Question: which one of the following is the true statement about mongodb&#39;s operation in these scenarios?</span></p><p class="c5"><span class="c3">A. The MongoDB primary does not write to its datafiles until a majority acknowledgement comes back from the rest of the cluster. When 27003 was primary, that was never received for writes 7,8,9.</span></p><p class="c5"><span class="c3">B. Mongo preserves the order of writes in a collection in its consistency model. In this problem, 27003&#39;s oplog was effectively a &quot;fork&quot; and to preserve write ordering a rollback was necessary during 27003&#39;s recovery phase.</span></p><p class="c5"><span class="c3">C. When 27003 came back up, it transmitted its write ops that the other members had not seen yet to those members so that they would have them also.</span></p><p class="c4"><span class="c3"></span></p><p class="c5"><span class="c3">Ans: </span></p><p class="c5"><span class="c3">B</span></p><p class="c10"><span class="c8 c9"></span></p></body></html>