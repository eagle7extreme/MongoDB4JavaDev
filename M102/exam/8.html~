<html><head><title>Untitled document</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}.c8{line-height:1.4;text-align:right;direction:ltr;padding-bottom:8pt}.c6{line-height:1.5;padding-top:15pt;direction:ltr;padding-bottom:17pt}.c3{line-height:1.4;direction:ltr;padding-bottom:11pt}.c9{line-height:1.5;direction:ltr;padding-bottom:17pt}.c5{color:#ff0000;background-color:#ffffff;font-family:"Verdana"}.c15{color:#489b00;font-size:12pt;background-color:#ffffff}.c0{color:#615f5e;background-color:#f8f8f8;font-family:"Verdana"}.c16{color:#6ba539;font-size:15pt;background-color:#ffffff}.c14{color:#aaaaaa;background-color:#f7f7f7;font-family:"Verdana"}.c4{color:#615f5e;font-size:12pt;background-color:#ffffff}.c1{color:#116644;background-color:#ffffff;font-family:"Verdana"}.c13{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c7{color:#615f5e;background-color:#ffffff;font-family:"Verdana"}.c11{margin-left:22pt;padding-bottom:8pt}.c10{line-height:1.4;direction:ltr}.c2{height:11pt;direction:ltr}.c12{color:inherit;text-decoration:inherit}.title{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt}.subtitle{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt}h2{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h3{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h4{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt}h5{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}h6{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}</style></head><body class="c13"><h2 class="c3"><a name="h.x2g2s7evesxk"></a><span class="c16">Final: Final.8</span></h2><p class="c9"><span class="c4">We have been asked by our users to pull some data from a previous database backup of a sharded cluster. They&#39;d like us to set up a temporary data mart for this purpose, in addition to answering some questions from the data. The next few questions involve this user request.</span></p><p class="c6"><span class="c4">First we will restore the backup. Download </span><span class="c15"><a class="c12" href="https://education.10gen.com/static/m102-july-2013/handouts/gene_backup.4182fb76b092.zip">gene_backup.zip</a></span><span class="c4">&nbsp;from the education site. Unzip this to a temp location on your computer.</span></p><p class="c6"><span class="c4">The original cluster that was backed up consisted of two shards, each of which was a three member replica set. The first one named &quot;s1&quot; and the second &quot;s2&quot;. We have one mongodump (backup) for each shard, plus one of one of the config databases. After you unzip you will see something like this:</span></p><p class="c10"><span class="c0">$ ls -la bak<br>total 0<br>drwxr-xr-x &nbsp; 5 dwight &nbsp;staff &nbsp;170 Dec 11 13:47 .<br>drwxr-xr-x &nbsp;17 dwight &nbsp;staff &nbsp;578 Dec 11 13:49 ..<br>drwxr-xr-x &nbsp; 4 dwight &nbsp;staff &nbsp;136 Dec 11 13:45 config_server<br>drwxr-xr-x &nbsp; 5 dwight &nbsp;staff &nbsp;170 Dec 11 13:46 s1<br>drwxr-xr-x &nbsp; 5 dwight &nbsp;staff &nbsp;170 Dec 11 13:46 s2<br></span></p><p class="c9"><span class="c4">Our data mart will be temporary, so we won&#39;t need more than one mongod per shard, nor more than one config server (we are not worried about downtime, the mart is temporary).</span></p><p class="c6"><span class="c4">As a first step, restore the config server backup and run a mongod config server instance with that restored data. The backups were made with mongodump. Thus you will use the mongorestore utility to restore.</span></p><p class="c6"><span class="c4">Once you have the config server running, confirm the restore of the config server data by running the last javascript line below in the mongo shell, and entering the 5 character result it returns.</span></p><p class="c10"><span class="c0">$ mongo localhost:27019/config<br>configsvr&gt; <br>configsvr&gt; db<br>config<br>configsvr&gt; db.chunks.find().sort({_id:1}).next().lastmodEpoch.getTimestamp().toString().substr(19,5)<br></span></p><p>Ans:</p><p class="c10 c11"><span class="c5">0</span><span class="c1">7</span><span class="c7">:</span><span class="c5">0</span><span class="c1">7</span></p><p class="c2"><span></span></p></body></html>
